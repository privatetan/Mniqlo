generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String?
  createdAt DateTime @default(now())
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  wxUserId        String?
  notifyFrequency Int      @default(60) // in minutes
  favorites       Favorite[]
  tasks     MonitorTask[]
  searchHistory   SearchHistory[]
  notificationLogs NotificationLog[]
}

model SearchHistory {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  keyword   String
  createdAt DateTime @default(now())

  @@index([userId, createdAt(sort: Desc)])
}

model Favorite {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  productId String
  code      String
  name      String?
  price     Float?
  style     String?
  size      String?
  imageUrl  String?
  createdAt DateTime @default(now())

  @@unique([userId, productId, style, size])
}

model MonitorTask {
  id          Int       @id @default(autoincrement())
  userId      Int
  user        User      @relation(fields: [userId], references: [id])
  productId   String
  style       String?
  size        String?
  targetPrice Float?
  frequency   Int       @default(60)
  isActive    Boolean   @default(true)
  startTime   String?   // Format "HH:mm"
  endTime     String?   // Format "HH:mm"
  logs        TaskLog[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model TaskLog {
  id        Int         @id @default(autoincrement())
  taskId    Int
  task      MonitorTask @relation(fields: [taskId], references: [id])
  status    String
  message   String?
  timestamp DateTime    @default(now())
}

model NotificationLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  productId String
  style     String?
  size      String?
  timestamp DateTime @default(now())

  @@index([userId, productId, timestamp(sort: Desc)])
}
